<!--
<script async src="https://www.googletagmanager.com/gtag/js?id=GT-5TG3DK3"
></script> -->

<script>
  // Lösche die Google Analytics Cookies sofort beim Laden der Seite
  document.cookie = "_ga=; Max-Age=0; path=/;";
  document.cookie = "_gid=; Max-Age=0; path=/;";
  document.cookie = "_gat=; Max-Age=0; path=/;";
</script>

<script async>
  // Google Tag Manager - Initialisierung
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, "script", "dataLayer", "GTM-PWK4LSL"); // Stelle sicher, dass du deine GTM-ID verwendest

  // Gtag Configuration
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }

  // Default consent configuration
  gtag("consent", "default", {
    ad_user_data: "denied",
    ad_personalization: "denied",
    ad_storage: "denied",
    analytics_storage: "denied",
    wait_for_update: 500,
  });

  gtag("js", new Date());

  // Google Analytics und Google Ads Initialisierung nach Einwilligung orginal
  /*
  function initializeGoogleAnalytics() {
    gtag("config", "GT-MR4MFC6", {
      anonymize_ip: true, // IP anonymisieren
      currency: "EUR",
      region: "EU",
      linker: {
        domains: ["musicstudio-ziebart.de", "www.musicstudio-ziebart.de"],
      },
    });
    // gtag("config", "G-CXBFDX52C7", { anonymize_ip: true }); // GA4 Tracking
  } */
  
  
  // Google Analytics wird erst nach Einwilligung geladen
  /*
function initializeGoogleAnalytics() {
  console.log("Google Analytics wird initialisiert...");
  
  gtag("config", "G-CXBFDX52C7", {
    anonymize_ip: true,
    currency: "EUR",
    region: "EU",
    linker: {
      domains: ["musicstudio-ziebart.de", "www.musicstudio-ziebart.de"],
    },
  });
  // gtag("config", "G-CXBFDX52C7", { anonymize_ip: true }); // GA4 Tracking
} */


  /*
  function initializeGoogleAnalytics() {
  if (window.dataLayer && window.dataLayer.some(e => e.event === 'cmpEventLoadFinished')) {
    gtag("config", "GT-MR4MFC6", {
      anonymize_ip: true,
      currency: "EUR",
      region: "EU",
      linker: {
        domains: ["musicstudio-ziebart.de", "www.musicstudio-ziebart.de"],
      },
    });
    gtag("config", "G-CXBFDX52C7", { anonymize_ip: true }); // GA4 Tracking
  }
} */

/*
function initializeGoogleAnalytics() {
  // Warte auf Consent-Entscheidung
  if (window.dataLayer && window.dataLayer.some(e => e.event === 'cmpEventLoadFinished')) {
    console.log("Google Analytics wird geladen...");

    gtag("config", "G-CXBFDX52C7", { anonymize_ip: true }); // GA4 Tracking
  } else {
    console.log("Google Analytics wird NICHT geladen (keine Zustimmung)");
  }
} */
/*
function initializeGoogleAnalytics() {
  if (window.dataLayer) {
    let consentGiven = window.dataLayer.some(e => e.event === 'cmpEventLoadFinished');
    if (consentGiven) {
      console.log("Google Analytics wird geladen...");
      gtag("config", "G-CXBFDX52C7", { anonymize_ip: true });
    } else {
      console.log("Google Analytics wird NICHT geladen (keine Zustimmung)");
    }
  }
}
window.addEventListener("load", initializeGoogleAnalytics); */


 /*
  function initializeGoogleAdWords() {
    gtag("config", "GT-5TG3DK3", {
      anonymize_ip: true,
      currency: "EUR",
      region: "EU",
      linker: {
        domains: ["musicstudio-ziebart.de", "www.musicstudio-ziebart.de"],
      },
    });
    gtag("config", "AW-1000620606", { anonymize_ip: true }); // Ads Tracking
  } */

  // Consent-Update-Funktion
  function setConsent() {
    gtag("consent", "update", {
      ad_user_data: "denied",
      ad_personalization: "denied",
      ad_storage: "denied",
      analytics_storage: "denied",
    });
  }
  
  // Event listener für die Zustimmung des Nutzers
  /*
  document.addEventListener("cmpEvent", function (event) {
    console.log("Einwilligungs-Event:", event);

    // Überprüfung, ob der Anbieter in den zugestimmten Listen enthalten ist
    if (event.detail.cmpConsentVendors) {
      console.log("Einwilligungsdaten:", event.detail);

      gtag("consent", "update", {
        ad_user_data: "granted",
        ad_personalization: "granted",
        ad_storage: "granted",
        analytics_storage: "granted",
      }); */


    // Event listener für die Zustimmung des Nutzers
document.addEventListener("cmpEvent", function (event) {
  console.log("Einwilligungs-Event:", event);

  // Überprüfung, ob der Anbieter in den zugestimmten Listen enthalten ist
  if (event.detail.cmpConsentVendors) {
    console.log("Einwilligungsdaten:", event.detail);

    // Nur wenn der Nutzer zugestimmt hat, werden die Cookies gesetzt
    if (event.detail.cmpConsentStatus === "granted") {
      // Update der Einwilligung für Analytics und Werbung
      gtag("consent", "update", {
        ad_user_data: "granted",
        ad_personalization: "granted",
        ad_storage: "granted",
        analytics_storage: "granted",
      });

      console.log("Einwilligung erteilt. Cookies werden gesetzt.");
    } else {
      // Wenn keine Einwilligung erteilt wurde, Cookies manuell löschen
      document.cookie = "_ga=; Max-Age=0; path=/;";
      document.cookie = "_gid=; Max-Age=0; path=/;";
      document.cookie = "_gat=; Max-Age=0; path=/;";
      console.log("Einwilligung verweigert. Cookies wurden gelöscht.");
    }
  }
});

      // GA4 erst jetzt starten ist neu
      // gtag("config", "G-CXBFDX52C7");

      // Initialisiere Google Analytics und Google Ads nur, wenn die Zustimmung erteilt wurde
      // initializeGoogleAnalytics();
      // initializeGoogleAdWords();
    

  document.addEventListener("consentGiven", function () {
    gtag("consent", "update", {
      ad_user_data: "granted",
      ad_personalization: "granted",
      ad_storage: "granted",
      analytics_storage: "granted",
    });
    // initializeGoogleAnalytics();
    // initializeGoogleAdWords();
  });
</script>
