<script async src="https://www.googletagmanager.com/gtag/js?id=GT-MR4MFC6"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=GT-5TG3DK3"></script>
<script async>
  // Google Tag Manager (Nur nach Zustimmung aktivieren)
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }

  // Standard Consent-Konfiguration (mit "denied" für alles)
  gtag("consent", "default", {
    "ad_user_data": "denied",
    "ad_personalization": "denied",
    "ad_storage": "denied",
    "analytics_storage": "denied",
    "wait_for_update": 500
  });

  // Führe dies nur aus, wenn der Benutzer seine Zustimmung erteilt hat
  function initializeGoogleTags() {
    // Google Analytics initialisieren
    gtag("config", "GT-MR4MFC6", {
      "anonymize_ip": true,
      "currency": "EUR",
      "region": "EU",
      "linker": {
        "domains": ["musicstudio-ziebart.de", "www.musicstudio-ziebart.de"]
      }
    });

    // Google Ads initialisieren
    gtag("config", "GT-5TG3DK3", {
      "anonymize_ip": true,
      "currency": "EUR",
      "region": "EU",
      "linker": {
        "domains": ["musicstudio-ziebart.de", "www.musicstudio-ziebart.de"]
      }
    });
  }

  // Event-Listener für die Einwilligung
  document.addEventListener('cmpEvent', function(event) {
    const consentData = event.detail;
    if (consentData && consentData.cmpGDPR === 1) {
      gtag("consent", "update", {
        "ad_user_data": "granted",
        "ad_personalization": "granted",
        "ad_storage": "granted",
        "analytics_storage": "granted"
      });

      // Nach der Zustimmung, Google Tags initialisieren
      initializeGoogleTags();
    }
  });

  // Fallback, wenn die Einwilligung bereits erteilt wurde
  document.addEventListener('consentGiven', function() {
    gtag("consent", "update", {
      "ad_user_data": "granted",
      "ad_personalization": "granted",
      "ad_storage": "granted",
      "analytics_storage": "granted"
    });

    initializeGoogleTags();
  });
</script>
