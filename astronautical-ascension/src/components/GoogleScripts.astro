---
const nonce = Astro.props.nonce;
---
<!-- Google Tag Manager und Google Analytics Skripte -->

<script async src="https://www.googletagmanager.com/gtag/js?id=GT-MR4MFC6"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=GT-5TG3DK3"></script>
<!--
<script async src="https://www.googletagmanager.com/gtag/js?id=GT-MR4MFC6" data-iub-purposes="4"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=GT-5TG3DK3" data-iub-purposes="4"></script> -->


<script async nonce={nonce}>
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, "script", "dataLayer", "GTM-PWK4LSL");

  

  // Gtag-Konfiguration f√ºr Analytics
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }

  // Zeitstempel
  gtag("js", new Date());

  // Consent Mode Standardwerte setzen
  gtag("consent", "default", {
    ad_storage: "denied",
    ad_personalization: "denied",
    ad_user_data: "denied",
    analytics_storage: "denied",
    functionality_storage: "denied",
    personalization_storage: "denied",
    security_storage: "denied"
  });

  // Consent Mode Update nach Einwilligung
  window.addEventListener("iubenda_consents_updated", function () {
    gtag("consent", "update", {
      ad_storage: "granted",
      ad_personalization: "granted",
      ad_user_data: "granted",
      analytics_storage: "granted",
      functionality_storage: "granted",
      personalization_storage: "granted",
      security_storage: "granted"
    });
  });

  // Google Analytics Konfiguration (optional)
  // gtag("config", "GT-MR4MFC6", { "anonymize_ip": true });
  // gtag("config", "GT-5TG3DK3", { "anonymize_ip": true });
</script>
