---
/* Falls nÃ¶tig: const nonce = Astro.props.nonce; */
---

<!-- âœ… Diese beiden Scripts sind essenziell fÃ¼r den Consent Mode -->
<script
  async
  type="text/plain"
  class="cmplazyload"
  data-cmp-vendor="s26"
  data-cmp-src="https://www.googletagmanager.com/gtag/js?id=GT-MR4MFC6"
></script>

<script
  async
  type="text/plain"
  class="cmplazyload"
  data-cmp-vendor="s1"
  data-cmp-src="https://www.googletagmanager.com/gtag/js?id=GT-5TG3DK3"
></script>

<!-- âœ… GTM und Gtag-Initialisierung -->
<script>
  window.dataLayer = window.dataLayer || [];
  (window as any).gtag = (window as any).gtag || function() { window.dataLayer.push(arguments); };

  // ðŸ›‘ StandardmÃ¤ÃŸig alles blockieren
  if (typeof (window as any).gtag === "function") {
    (window as any).gtag("consent", "default", {
      ad_user_data: "denied",
      ad_personalization: "denied",
      ad_storage: "denied",
      analytics_storage: "denied",
      wait_for_update: 500,
    });
  }

  // âœ… GTM nach Einwilligung laden
  document.addEventListener("cmpEvent", function (event: Event) {
    const consentEvent = (event as CustomEvent).detail || {}; 
    if (consentEvent.consented) {
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s) as HTMLScriptElement;
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + "&l=" + l;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-PWK4LSL");

      // âœ… Google Tags erst nach Consent aktivieren
      if (typeof (window as any).gtag === "function") {
        (window as any).gtag("consent", "update", {
          ad_user_data: "granted",
          ad_personalization: "granted",
          ad_storage: "granted",
          analytics_storage: "granted",
        });

        (window as any).gtag("config", "GT-MR4MFC6", {
          currency: "EUR",
          region: "EU",
          linker: {
            domains: ["musicstudio-ziebart.de", "www.musicstudio-ziebart.de"],
          },
        });

        (window as any).gtag("config", "GT-5TG3DK3", {
          currency: "EUR",
          region: "EU",
          linker: {
            domains: ["musicstudio-ziebart.de", "www.musicstudio-ziebart.de"],
          },
        });
      }
    }
  });
</script>
