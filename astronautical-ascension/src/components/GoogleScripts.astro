<script async src="https://www.googletagmanager.com/gtag/js?id=GT-MR4MFC6"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=GT-5TG3DK3"></script>
<script async>
  // Google Tag Manager - Initialisierung
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, "script", "dataLayer", "GTM-PWK4LSL"); // Stelle sicher, dass du deine GTM-ID verwendest

  // Google Analytics und Google Ads Initialisierung nach Einwilligung
  function initializeGoogleAnalytics() {
    gtag("config", "GT-MR4MFC6", {
      "anonymize_ip": true,  // IP anonymisieren
      "currency": "EUR",
      "region": "EU",
      "linker": {
        "domains": ["musicstudio-ziebart.de", "www.musicstudio-ziebart.de"]
      }
    });
    gtag("config", "G-CXBFDX52C7", {"anonymize_ip": true}); // GA4 Tracking
  }

  function initializeGoogleAdWords() {
    gtag("config", "GT-5TG3DK3", {
      "anonymize_ip": true,
      "currency": "EUR",
      "region": "EU",
      "linker": {
        "domains": ["musicstudio-ziebart.de", "www.musicstudio-ziebart.de"]
      }
    });
    gtag("config", "AW-1000620606", {"anonymize_ip": true}); // Ads Tracking
  }

  // Google Tag Manager Consent Management
  function setConsent() {
    gtag("consent", "update", {
      "ad_user_data": "denied",
      "ad_personalization": "denied",
      "ad_storage": "denied",
      "analytics_storage": "denied"
    });
  }

  // Event listener f√ºr die Zustimmung des Nutzers
  document.addEventListener('cmpEvent', function(event) {
    console.log('Einwilligungs-Event:', event);
    if (event.detail.cmpConsentVendors) {
      console.log('Einwilligungsdaten:', event.detail);
      gtag("consent", "update", {
        "ad_user_data": "granted",
        "ad_personalization": "granted",
        "ad_storage": "granted",
        "analytics_storage": "granted"
      });
      initializeGoogleAnalytics();
      initializeGoogleAdWords();
    }
  });

  document.addEventListener('consentGiven', function() {
    gtag("consent", "update", {
      "ad_user_data": "granted",
      "ad_personalization": "granted",
      "ad_storage": "granted",
      "analytics_storage": "granted"
    });
    initializeGoogleAnalytics();
    initializeGoogleAdWords();
  });
</script>
